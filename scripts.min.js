"use strict";function _defineProperty(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const ENEMY_TYPES=["ballom","onil","dahl","minvo"],POWER_UP_TYPES=["bombs","flames","speed","wall-pass","detonator","bomb-pass","flame-pass","mystery"],AUDIO_VOLUME=.05,ENEMY_XP_SHOW_TIME=2e3,getRandomInt=(e,t)=>(e=Math.ceil(e),t=Math.ceil(t),Math.floor(Math.random()*(t-e))+e),getRandomDirection=(e=["left","right","up","down"])=>e[getRandomInt(0,e.length)],playExplosionSound=()=>{const e=document.createElement("audio");e.src="./sounds/explosion.wav",e.volume=AUDIO_VOLUME,e.play().then()},playBombLeaveSound=()=>{const e=document.createElement("audio");e.src="./sounds/leave-bomb.wav",e.volume=AUDIO_VOLUME,e.play().then()},playPowerUpPicked=()=>{const e=document.createElement("audio");e.src="./sounds/power-up.wav",e.volume=AUDIO_VOLUME,e.play().then()};class Timer{constructor(e,t){this.callback=e,this.remaining=t,this.resume()}pause(){clearTimeout(this.timerID),this.remaining-=(new Date).getTime()-this.start}resume(){this.start=(new Date).getTime(),this.clear(),this.timerID=setTimeout(this.callback,this.remaining)}clear(){clearTimeout(this.timerID)}}class Entity{constructor({board:e,pixelSize:t,left:s,top:i,speed:o}){_defineProperty(this,"createHTML",()=>{this.div=document.createElement("div"),this.div.style.position="absolute",this.img=document.createElement("img"),this.img.alt="entity",this.div.append(this.img),this.board.append(this.div),this.div.style.height=`${this.size}px`,this.div.style.width=`${this.size}px`}),this.board=e,this.pixelSize=t,this.speed=o||t/3,this.left=s||2*t,this.top=i||2*t,this.size=16*t*.75,this.wallPass=!1,this.createHTML(),this.draw()}moveLeft(){this.left-=this.speed}moveRight(){this.left+=this.speed}moveUp(){this.top-=this.speed}moveDown(){this.top+=this.speed}draw(){this.div.style.transform=`translate3d(${16*this.pixelSize+this.left}px, ${16*this.pixelSize+this.top}px, 0)`}getBorders(e,t,{own:s=!0,collideWithDoor:i=!1,floorValues:o=!1}={}){let r,a,n,h,m=0;return s||(m=1),i&&(m-=8*e),this instanceof Bomberman?(r=(this.left-m+(e+1))/t+2,a=(this.left+m+this.size-(e+1))/t+2,n=(this.top-m)/t+2,h=(this.top+m-1+this.size-(e-1))/t+2):(r=(this.left-m)/t+2,a=(this.left+m+this.size)/t+2,n=(this.top-m)/t+2,h=(this.top+m+this.size)/t+2),o&&(r=Math.floor(r),a=Math.floor(a),n=Math.floor(n),h=Math.floor(h)),{left:r,right:a,top:n,bottom:h}}}class EnemyXP{constructor({board:e,left:t,top:s,amount:i,pixelSize:o}){_defineProperty(this,"deleteAfter",()=>{new Timer(()=>{this.div.remove()},ENEMY_XP_SHOW_TIME)}),this.board=e,this.left=t,this.top=s,this.amount=i,this.pixelSize=o,this.initialize()}initialize(){this.createHTML(),this.deleteAfter()}createHTML(){this.div=document.createElement("div"),this.div.className="enemy-xp",this.div.innerText=this.amount,this.div.style.transform=`translate3d(${this.left}px, ${this.top+3*this.pixelSize}px, 0)`,this.board.append(this.div)}}class Enemy extends Entity{constructor({board:e,pixelSize:t,left:s,top:i,xp:o,type:r}){super({board:e,pixelSize:t,left:s,top:i}),_defineProperty(this,"handleType",()=>{switch(this.type){case"ballom":this.xp=100,this.speed/=3,this.createHTML("./img/enemies/ballom.png");break;case"onil":this.xp=200,this.speed/=2,this.createHTML("./img/enemies/onil.png");break;case"dahl":this.xp=400,this.createHTML("./img/enemies/dahl.png");break;case"minvo":this.xp=800,this.speed*=1.5,this.createHTML("./img/enemies/minvo.png")}}),_defineProperty(this,"createHTML",e=>{this.div.className="enemy",this.img.src=e}),this.direction=getRandomDirection(),this.dead=!1,this.xp=o,this.type=r,this.handleType()}moveLeft(){super.moveLeft(),this.img.className="enemy-walk-left",this.direction="left"}moveRight(){super.moveRight(),this.img.className="enemy-walk-right",this.direction="right"}moveUp(){super.moveUp(),this.img.className="enemy-walk-up",this.direction="up"}moveDown(){super.moveDown(),this.img.className="enemy-walk-down",this.direction="down"}die(){this.img.className="enemy-die",this.dead=!0,this.timer=new Timer(()=>{this.img.className="enemy-dead",this.div.remove(),new EnemyXP({board:this.board,left:this.left,top:this.top,amount:this.xp,pixelSize:this.pixelSize})},1100)}}class Bomberman extends Entity{constructor({board:e,pixelSize:t,liveCount:s}){super({board:e,pixelSize:t}),_defineProperty(this,"resetPosition",()=>{this.left=0,this.top=0}),_defineProperty(this,"initialize",()=>{this.createHTML()}),_defineProperty(this,"createHTML",()=>{this.div.id="bomberman",this.img.src="./img/bomberman.png",this.img.alt="bomberman",this.liveCountDiv=document.createElement("div"),this.liveCountDiv.id="live-count";const e=document.createElement("img");e.src="./img/game-info/heart.png",e.alt="heart";const t=document.createElement("span");t.textContent=`${this.liveCount}`,this.liveCountDiv.append(e),this.liveCountDiv.append(t),document.querySelector("#game-info").append(this.liveCountDiv)}),_defineProperty(this,"restart",()=>{this.left=this.pixelSize,this.top=this.pixelSize}),this.direction="down",this.liveCount=s,this.bombPass=!1,this.flamePass=!1,this.detonator=!1,this.isSurroundedWithBombs=!1}moveLeft(){super.moveLeft(),this.img.className="bomberman-walk-left",this.direction="left"}moveRight(){super.moveRight(),this.img.className="bomberman-walk-right",this.direction="right"}moveUp(){super.moveUp(),this.img.className="bomberman-walk-up",this.direction="up"}moveDown(){super.moveDown(),this.img.className="bomberman-walk-down",this.direction="down"}die(){this.img.className="bomberman-die",this.liveCount--,this.timer=new Timer(()=>{this.img.className="bomberman-dead"},600)}}class Block{constructor({board:e,x:t,y:s}){_defineProperty(this,"createHTML",()=>{this.div=document.createElement("div"),this.div.style.gridColumnStart=String(this.x),this.div.style.gridRowStart=String(this.y),this.board.append(this.div)}),_defineProperty(this,"initialize",()=>{this.createHTML()}),this.board=e,this.x=t,this.y=s,this.initialize()}}class Rock extends Block{constructor({board:e,x:t,y:s}){super({board:e,x:t,y:s}),_defineProperty(this,"addClass",()=>{this.div.classList.add("rock")}),this.addClass()}}class ExitDoor extends Block{constructor({board:e,x:t,y:s}){super({board:e,x:t,y:s}),_defineProperty(this,"addClass",()=>{this.div.classList.add("exit-door")}),this.addClass()}}class PowerUp extends Block{constructor({board:e,x:t,y:s,type:i}){super({board:e,x:t,y:s}),_defineProperty(this,"addClass",()=>{this.div.classList.add("power-up",`power-up-${this.type}`)}),this.type=i,this.addClass()}}class Wall extends Block{constructor({board:e,x:t,y:s}){super({board:e,x:t,y:s}),_defineProperty(this,"addClass",()=>{this.div.classList.add("wall")}),_defineProperty(this,"addImage",()=>{this.addClass(),this.img=document.createElement("img"),this.img.src="./img/wall.png",this.img.alt="wall",this.div.append(this.img)}),this.addImage()}explode(){this.img.classList.add("wall-explode")}}class Bomb{constructor({board:e,x:t,y:s,explosionSize:i,stage:o}){_defineProperty(this,"initialize",()=>{this.createHTML(),this.explodeAfter()}),_defineProperty(this,"createHTML",()=>{this.div=document.createElement("div"),this.img=document.createElement("img"),this.img.alt="bomb",this.div.classList.add("bomb"),this.div.style.gridColumnStart=String(this.x),this.div.style.gridRowStart=String(this.y),this.img.classList.add("bomb-exploding"),this.img.src="./img/bomb.png",this.div.append(this.img),this.board.append(this.div)}),_defineProperty(this,"createExplosions",()=>{this.div.remove(),this.explosion=new Explosion({board:this.board,x:this.x,y:this.y,size:this.explosionSize,stage:this.stage}),playExplosionSound()}),_defineProperty(this,"explodeAfter",()=>{this.timer=new Timer(()=>{this.createExplosions(),this.stage.deleteBomb(this.x,this.y)},this.stage.options.explosionTime)}),this.board=e,this.x=t,this.y=s,this.explosionSize=i,this.stage=o,this.initialize()}}class Explosion{constructor({board:e,x:t,y:s,size:i,stage:o}){_defineProperty(this,"createHTMLForOne",(e,t,s)=>{const i=document.createElement("div"),o=document.createElement("img");return i.classList.add("explosion"),o.classList.add(s),o.src="./img/explosion.png",o.alt="explosion",i.style.gridColumnStart=String(e),i.style.gridRowStart=String(t),i.append(o),this.board.append(i),i}),_defineProperty(this,"create",(e,t,s)=>{let i,o=!0;if("explosion-center"!==s&&this.stage.isBomb(e,t)){this.stage.getBomb(e,t).instant=!0,o=!1}else if(this.stage.isBlock(e,t,{bombPass:!0}))if(this.stage.isWall(e,t)){this.stage.getWall(e,t).explode(),new Timer(()=>{this.stage.deleteWall(e,t)},500),o=!1}else this.stage.isRock(e,t)&&(o=!1);else i=this.createHTMLForOne(e,t,s),this.stage.explosions.push({data:i,x:e,y:t}),new Timer(()=>{this.stage.deleteExplosion(e,t)},500),o=!0;return{created:o,data:i}}),_defineProperty(this,"createCenter",()=>{const{data:e}=this.create(this.x,this.y,"explosion-center");this.divs.push(e)}),_defineProperty(this,"createLeft",()=>{const{data:e}=this.create(this.x-this.size,this.y,"explosion-left");this.divs.push(e)}),_defineProperty(this,"createRight",()=>{const{data:e}=this.create(this.x+this.size,this.y,"explosion-right");this.divs.push(e)}),_defineProperty(this,"createTop",()=>{const{data:e}=this.create(this.x,this.y-this.size,"explosion-top");this.divs.push(e)}),_defineProperty(this,"createBottom",()=>{const{data:e}=this.create(this.x,this.y+this.size,"explosion-bottom");this.divs.push(e)}),_defineProperty(this,"createLeftHorizontals",()=>{for(let e=this.x-1; e>=this.x-this.size+1; e--){const{created:t,data:s}=this.create(e,this.y,"explosion-horizontal");if(!t)return!1;this.divs.push(s)}return!0}),_defineProperty(this,"createRightHorizontals",()=>{for(let e=this.x+1; e<this.x+this.size; e++){const{created:t,data:s}=this.create(e,this.y,"explosion-horizontal");if(!t)return!1;this.divs.push(s)}return!0}),_defineProperty(this,"createTopVerticals",()=>{for(let e=this.y-1; e>=this.y-this.size+1; e--){const{created:t,data:s}=this.create(this.x,e,"explosion-vertical");if(!t)return!1;this.divs.push(s)}return!0}),_defineProperty(this,"createBottomVerticals",()=>{for(let e=this.y+1; e<this.y+this.size; e++){const{created:t,data:s}=this.create(this.x,e,"explosion-vertical");if(!t)return!1;this.divs.push(s)}return!0}),_defineProperty(this,"createHTML",()=>{this.createCenter(),this.createLeftHorizontals()&&this.createLeft(),this.createRightHorizontals()&&this.createRight(),this.createTopVerticals()&&this.createTop(),this.createBottomVerticals()&&this.createBottom()}),this.board=e,this.x=t,this.y=s,this.size=i,this.stage=o,this.divs=[],this.createHTML()}}class KeyListener{constructor(){_defineProperty(this,"initialize",()=>{document.addEventListener("keydown", e=>{this.keysPressed[e.code]=!0}),document.addEventListener("keyup", e=>{this.keysPressed[e.code]=!1})}),_defineProperty(this,"isPressed", e=>this.keysPressed[e]),this.keysPressed={},this.initialize()}}class StageOptions{constructor({rows:e,columns:t,pixelSize:s,tileSize:i,enemies:o,bombCount:r,explosionTime:a,explosionSize:n,chainExplosionTime:h,roundTime:m,score:l,powerUps:d}){_defineProperty(this,"initialize",()=>{this.initializeTimer(),this.initializeScore()}),_defineProperty(this,"draw",()=>{this.drawTimer(),this.drawScore()}),_defineProperty(this,"drawScore",()=>{this.scoreDiv.querySelector("span").innerText=`${this.score}`}),_defineProperty(this,"drawTimer",()=>{this.timer.querySelector("span").innerText=`${this.roundTime}`}),_defineProperty(this,"initializeTimer",()=>{const e=document.querySelector("#timer");e&&e.remove(),this.timer=document.createElement("div"),this.timer.id="timer";const t=document.createElement("img");t.src="./img/game-info/clock.png",t.alt="clock";const s=document.createElement("span");s.innerText=`${this.roundTime}`,this.timer.append(t),this.timer.append(s),document.querySelector("#game-info").append(this.timer)}),_defineProperty(this,"initializeScore",()=>{const e=document.querySelector("#score");e&&e.remove(),this.scoreDiv=document.createElement("div"),this.scoreDiv.id="score";const t=document.createElement("img");t.src="./img/game-info/star.png",t.alt="star";const s=document.createElement("span");s.innerText=`${this.score}`,this.scoreDiv.append(t),this.scoreDiv.append(s),document.querySelector("#game-info").append(this.scoreDiv)}),_defineProperty(this,"initializeTimerChange",()=>{this.resetRoundTime(),clearInterval(this.interval),this.interval=setInterval(()=>{this.roundTime--,this.passedTime++,this.roundTime<=0&&clearInterval(this.interval)},1e3)}),_defineProperty(this,"resetRoundTime",()=>{this.roundTime+=this.passedTime,this.passedTime=0}),this.rows=e,this.columns=t,this.pixelSize=s,this.tileSize=i,this.enemies=o,this.bombCount=r,this.explosionTime=a,this.explosionSize=n,this.chainExplosionTime=h,this.roundTime=m,this.passedTime=0,this.score=l,this.initialScore=l,this.powerUps=d,this.initialize()}}class Stage{constructor({data:e,pixelSize:t,tileSize:s,bombCount:i,explosionTime:o,explosionSize:r,chainExplosionTime:a}){if(_defineProperty(this,"increaseBombCount",()=>{this.bombCount++,this.options.bombCount++}),_defineProperty(this,"checkArguments",(e, t, s, i, o)=>{if(isNaN(e)||e<7)return"incorrect number of rows";if(isNaN(t)||t<7)return"incorrect number of columns";if(isNaN(s)||s<10)return"incorrect roundTime";if(!(i instanceof Object))return"incorrect enemies";if(i)for(const e of Object.keys(i)){if(!ENEMY_TYPES.includes(e))return`incorrect type of enemy: ${e}`;if(isNaN(i[e])||i[e]<1)return`incorrect number of enemies: ${e}`}if(void 0!==o&&!(o instanceof Object))return"incorrect type of powerUps";if(o)for(const e of Object.keys(o)){if(!POWER_UP_TYPES.includes(e))return`incorrect type of powerUp: ${e}`;if(isNaN(o[e])||o[e]<1)return`incorrect number of enemies: ${e}`}}),_defineProperty(this,"reinitialize", e=>{this.removeAllDivs();const t=e.rows||13,s=e.columns||31,i=e.roundTime||200,o=e.enemies,r=e.powerUps||{},{pixelSize:a,tileSize:n,bombCount:h,explosionSize:m,explosionTime:l,chainExplosionTime:d,score:p}=this.options;this.options=new StageOptions({rows:t,columns:s,pixelSize:a,tileSize:n,enemies:o,bombCount:h,explosionSize:m,explosionTime:l,chainExplosionTime:d,roundTime:i,score:p,powerUps:r}),this.createHTML(),this.changeStyles()}),_defineProperty(this,"removeArrayElements", e=>{this[e]=this[e].filter(e=>(e.div.remove(),!1))}),_defineProperty(this,"removeAllDivs",()=>{this.removeArrayElements("rocks"),this.removeArrayElements("walls"),this.removeArrayElements("enemies"),this.removeArrayElements("explosions"),this.removeArrayElements("powerUps"),this.exitDoor.div.remove()}),_defineProperty(this,"restart",()=>{this.options.bombCount=this.bombCount,this.removeAllDivs(),this.createHTML()}),_defineProperty(this,"createRocks",()=>{for(let e=1; e<=this.options.columns; e++)this.rocks.push(new Rock({x:e,y:1,board:this.board})),this.rocks.push(new Rock({x:e,y:this.options.rows,board:this.board}));for(let e=2; e<this.options.rows; e++)this.rocks.push(new Rock({x:1,y:e,board:this.board})),this.rocks.push(new Rock({x:this.options.columns,y:e,board:this.board}));for(let e=3; e<this.options.columns; e+=2)for(let t=3; t<this.options.rows; t+=2)this.rocks.push(new Rock({x:e,y:t,board:this.board}))}),_defineProperty(this,"createWalls",()=>{const e=Math.round(this.options.rows*this.options.columns/8),t=getRandomInt(.9*e,1.1*e);let s=0;for(; s<t;){const e=getRandomInt(1,this.options.columns+1),t=getRandomInt(1,this.options.rows+1);this.isBlock(e,t)||e<=3&&t<=3||(this.walls.push(new Wall({x:e,y:t,board:this.board})),s++)}}),_defineProperty(this,"createPowerUps",()=>{if(this.options.powerUps)for(const e of Object.keys(this.options.powerUps)){let t=0;for(; t<this.options.powerUps[e];){const s=getRandomInt(1,this.options.columns+1),i=getRandomInt(1,this.options.rows+1);this.isPowerUp(s,i)||!this.isWall(s,i)||this.isExitDoor(s,i)||(this.powerUps.push(new PowerUp({board:this.board,x:s,y:i,type:e})),t++)}}}),_defineProperty(this,"createExitDoor",()=>{for(;;){const e=getRandomInt(1,this.options.columns),t=getRandomInt(1,this.options.rows);if(this.isWall(e,t))return void(this.exitDoor=new ExitDoor({board:this.board,x:e,y:t}))}}),_defineProperty(this,"createEnemies",()=>{if(this.options.enemies)for(const e of Object.keys(this.options.enemies)){let t=0;for(; t<this.options.enemies[e];){const s=getRandomInt(1,this.options.columns+1),i=getRandomInt(1,this.options.rows+1);if(!(this.isBlock(s,i)||s<5&&i<5)){const o=this.options.tileSize*(s-2),r=this.options.tileSize*(i-2);this.enemies.push(new Enemy({board:this.board,pixelSize:this.options.pixelSize,left:o,top:r,type:e})),t++}}}}),_defineProperty(this,"createHTML",()=>{this.createRocks(),this.createWalls(),this.createExitDoor(),this.createEnemies(),this.createPowerUps()}),_defineProperty(this,"addStyles",()=>{const e=document.createElement("style");e.id="board-style",document.querySelector("head").append(e)}),_defineProperty(this,"changeStyles",()=>{document.querySelector("#board-style").innerHTML=`\n\t\t\t#board {\n\t\t\t\tgrid-template-rows: repeat(${this.options.rows}, ${this.options.tileSize}px);\n\t\t\t\tgrid-template-columns: repeat(${this.options.columns}, ${this.options.tileSize}px);\n\t\t\t}`,this.board.style.width=`${this.options.tileSize*this.options.columns}px`,this.board.style.height=`${this.options.tileSize*this.options.rows}px`}),_defineProperty(this,"initialize",()=>{this.createHTML(),this.addStyles(),this.changeStyles()}),_defineProperty(this,"isPowerUp",(e, t)=>this.powerUps.some(s=>s.x===e&&s.y===t)),_defineProperty(this,"isRock",(e, t)=>this.rocks.some(s=>s.x===e&&s.y===t)),_defineProperty(this,"isWall",(e, t)=>this.walls.some(s=>s.x===e&&s.y===t)),_defineProperty(this,"isBomb",(e, t)=>this.bombs.some(s=>s.x===Math.floor(e)&&s.y===Math.floor(t))),_defineProperty(this,"isExplosion",(e, t, {flamePass:s=!1}={})=>!s&&this.explosions.some(s=>s.x===e&&s.y===t)),_defineProperty(this,"isBlock",(e, t, {bombPass:s=!1,wallPass:i=!1,enemy:o=!1}={})=>(e=Math.floor(e),t=Math.floor(t),e<1||t<1||e>this.options.columns||t>this.options.rows||this.isRock(e,t)||!i&&this.isWall(e,t)||!s&&this.isBomb(e,t)||o&&this.isExitDoor(e,t))),_defineProperty(this,"isExitDoor",(e, t)=>this.exitDoor.x===e&&this.exitDoor.y===t),_defineProperty(this,"getWall",(e, t)=>this.walls.filter(s=>s.x===e&&s.y===t)[0]),_defineProperty(this,"getBomb",(e, t)=>this.bombs.filter(s=>s.x===e&&s.y===t)[0]),_defineProperty(this,"getPowerUp",(e, t)=>this.powerUps.filter(s=>s.x===e&&s.y===t)[0]),_defineProperty(this,"deleteWall",(e, t)=>{this.walls=this.walls.filter(s=>s.x!==e||s.y!==t||(s.div.remove(),!1))}),_defineProperty(this,"deletePowerUp",(e, t)=>{this.powerUps=this.powerUps.filter(s=>s.x!==e||s.y!==t||(s.div.remove(),!1))}),_defineProperty(this,"deleteBomb",(e, t)=>{this.bombs=this.bombs.filter(s=>s.x!==e||s.y!==t||(s.div.remove(),clearTimeout(s.timeout),!1)),this.options.bombCount++}),_defineProperty(this,"deleteExplosion",(e, t)=>{this.explosions=this.explosions.filter(s=>s.x!==e||s.y!==t||(s.data.remove(),!1))}),_defineProperty(this,"deleteEnemy", e=>{this.enemies=this.enemies.filter(t=>t!==e)}),_defineProperty(this,"addBomb", e=>{this.bombs.push(e),this.options.bombCount--}),!(e instanceof Object))return void(this.error="incorrect type of stage");const n=e.rows||13,h=e.columns||31,m=e.roundTime||200,l=e.enemies||{},d=e.powerUps||{},p=this.checkArguments(n,h,m,l,d);p?this.error=p:(this.board=document.querySelector("#board"),this.bombCount=i,this.options=new StageOptions({rows:n,columns:h,pixelSize:t,tileSize:s,enemies:e.enemies,bombCount:i,powerUps:e.powerUps,explosionSize:r,explosionTime:o,chainExplosionTime:a,roundTime:m,score:0}),this.rocks=[],this.walls=[],this.enemies=[],this.bombs=[],this.explosions=[],this.powerUps=[])}}class GameMenu{constructor(){_defineProperty(this,"show",()=>{this.selected=0,this.div.className="game-menu-show",document.addEventListener("keyup",this.listener)}),_defineProperty(this,"hide",()=>{this.div.className="game-menu-hide",document.removeEventListener("keyup",this.listener)}),_defineProperty(this,"draw",()=>{this.items.forEach((e, t)=>{e.className="game-menu-item",this.selected===t&&e.classList.add("game-menu-item-selected")})}),_defineProperty(this,"listener", e=>{"ArrowDown"===e.code?this.selected=(this.selected+1)%this.items.length:"ArrowUp"===e.code&&(this.selected=(this.selected-1)%this.items.length,this.selected<0&&(this.selected=this.items.length-1))}),this.div=document.querySelector("#game-menu"),this.items=document.querySelectorAll(".game-menu-item"),this.selected=0}}class Music{constructor(e){_defineProperty(this,"play",()=>{this.audio.play().then()}),_defineProperty(this,"pause",()=>{this.audio.pause()}),_defineProperty(this,"clear",()=>{this.audio.currentTime=0}),_defineProperty(this,"stop",()=>{this.pause(),this.clear()}),_defineProperty(this,"durationMS",()=>1e3*this.audio.duration),this.audio=document.getElementById(e),this.audio.volume=AUDIO_VOLUME}}class GameMusic{constructor(){_defineProperty(this,"stopStageMusic",()=>{this.stage.stop(),this.findExit.stop()}),this.titleScreen=new Music("title-screen-music"),this.stageStart=new Music("stage-start-music"),this.stage=new Music("stage-music"),this.lifeLost=new Music("life-lost-music"),this.ending=new Music("ending-music"),this.over=new Music("over-music"),this.complete=new Music("stage-complete-music"),this.findExit=new Music("find-exit-music"),this.pause=new Music("pause-music"),this.die=new Music("die-music")}}class Screen{constructor(e){_defineProperty(this,"hide",()=>{this.div.style.opacity="0"}),_defineProperty(this,"show",()=>{this.div.style.opacity="1"}),_defineProperty(this,"hideDisplay",()=>{this.div.style.display="none"}),_defineProperty(this,"showDisplay",()=>{this.div.style.display="flex"}),this.div=document.querySelector(`#${e}`),this.hide()}}class GameScreen{constructor(){_defineProperty(this,"showStage",()=>{this.stage.show(),this.info.show()}),_defineProperty(this,"hideStage",()=>{this.stage.hide(),this.info.hide()}),this.mainMenu=new Screen("main-menu"),this.mainMenu.show(),this.stageStart=new Screen("stage-start"),this.gameOver=new Screen("game-over"),this.gameOver.show(),this.gameOver.hideDisplay(),this.stage=new Screen("board"),this.ending=new Screen("ending"),this.ending.show(),this.ending.hideDisplay(),this.info=new Screen("game-info"),this.incorrectArguments=new Screen("incorrect-arguments"),this.incorrectArguments.show(),this.incorrectArguments.hideDisplay()}}class Game{constructor({pixelSize:e=3,explosionTime:t=2e3,explosionSize:s=1,bombCount:i=1,liveCount:o=3,chainExplosionTime:r=100,stages:a}={}){_defineProperty(this,"checkArguments",(e, t, s, i, o, r, a)=>isNaN(e)||e<1?"incorrect pixelSize":isNaN(t)||t<500?"incorrect explosionTime":isNaN(s)||s<1?"incorrect explosionSize":isNaN(i)||i<1?"incorrect bombCount":isNaN(o)||o<1?"incorrect liveCount":isNaN(r)||r<1?"incorrect chainExplosionTime":a instanceof Array?void 0:"incorrect type of stages"),_defineProperty(this,"handleUserInteraction",()=>{const e=()=>{this.music=new GameMusic,this.state="pre-main-menu",document.querySelector("#click-me").remove(),document.removeEventListener("click",e)};document.addEventListener("click",e)}),_defineProperty(this,"isBombermanCollidedWithExitDoor",()=>{const{left:e,right:t,top:s,bottom:i}=this.bomberman.getBorders(this.stage.options.pixelSize,this.stage.options.tileSize,{own:!0,collideWithDoor:!0,floorValues:!0});return this.stage.isExitDoor(e,s)||this.stage.isExitDoor(e,i)||this.stage.isExitDoor(t,s)||this.stage.isExitDoor(t,i)}),_defineProperty(this,"updateStage",()=>{this.stageNumber++,document.querySelector("#stage-start span").innerText=`${this.stageNumber+1}`}),_defineProperty(this,"handleBombermanCollidedWithPowerUp",()=>{const{left:e,right:t,top:s,bottom:i}=this.bomberman.getBorders(this.stage.options.pixelSize,this.stage.options.tileSize,{own:!0,floorValues:!0});let o;if(this.stage.isPowerUp(e,s)&&!this.stage.isWall(e,s)?o=this.stage.getPowerUp(e,s):this.stage.isPowerUp(e,i)&&!this.stage.isWall(e,i)?o=this.stage.getPowerUp(e,i):this.stage.isPowerUp(t,s)&&!this.stage.isWall(t,s)?o=this.stage.getPowerUp(t,s):this.stage.isPowerUp(t,i)&&!this.stage.isWall(t,i)&&(o=this.stage.getPowerUp(t,i)),o){switch(playPowerUpPicked(),o.type){case"bombs":this.stage.updateBombCountBy();break;case"flames":this.stage.options.explosionSize++;break;case"speed":this.bomberman.speed+=.1;break;case"wall-pass":this.bomberman.wallPass=!0;break;case"detonator":this.bomberman.detonator=!0;break;case"bomb-pass":this.bomberman.bombPass=!0;break;case"flame-pass":this.bomberman.flamePass=!0}this.stage.deletePowerUp(o.x,o.y)}}),_defineProperty(this,"handleBombermanSurroundedWithBombs",(e, t, s, i)=>{this.stage.isBomb(e,s)||this.stage.isBomb(e,i)||this.stage.isBomb(t,s)||this.stage.isBomb(t,i)||(this.bomberman.isSurroundedWithBombs=!1)}),_defineProperty(this,"handleBombermanMove",()=>{const{left:e,right:t,top:s,bottom:i}=this.bomberman.getBorders(this.stage.options.pixelSize,this.stage.options.tileSize,{own:!1});this.handleBombermanSurroundedWithBombs(e,t,s,i);let o=!1;const r=this.bomberman.isSurroundedWithBombs,a=this.bomberman.bombPass||r,n=this.bomberman.wallPass;this.keyListener.isPressed("KeyA")&&!this.keyListener.isPressed("KeyD")&&(this.stage.isBlock(e,s+.05,{bombPass:a,wallPass:n})||this.stage.isBlock(e,i-.05,{bombPass:a,wallPass:n})||(this.bomberman.moveLeft(),o=!0)),this.keyListener.isPressed("KeyD")&&!this.keyListener.isPressed("KeyA")&&(this.stage.isBlock(t,s+.05,{bombPass:a,wallPass:n})||this.stage.isBlock(t,i-.05,{bombPass:a,wallPass:n})||(this.bomberman.moveRight(),o=!0)),this.keyListener.isPressed("KeyW")&&!this.keyListener.isPressed("KeyS")&&(this.stage.isBlock(e+.05,s,{bombPass:a,wallPass:n})||this.stage.isBlock(t-.05,s,{bombPass:a,wallPass:n})||(this.bomberman.moveUp(),o=!0)),this.keyListener.isPressed("KeyS")&&!this.keyListener.isPressed("KeyW")&&(this.stage.isBlock(e+.05,i,{bombPass:a,wallPass:n})||this.stage.isBlock(t-.05,i,{bombPass:a,wallPass:n})||(this.bomberman.moveDown(),o=!0)),o||(this.bomberman.img.className=`bomberman-look-${this.bomberman.direction}`)}),_defineProperty(this,"updateEnemies",()=>{this.stage.enemies.forEach(e=>{this.updateEnemy(e)})}),_defineProperty(this,"updateEnemy", e=>{this.handleEnemyExplosion(e),this.moveEnemyRandomly(e)}),_defineProperty(this,"updateInstantBombs",()=>{this.stage.bombs.forEach(e=>{e.instant&&(e.instant=!1,e.timer.clear(),e.timer=new Timer(()=>{e.createExplosions(),this.stage.deleteBomb(e.x,e.y)},this.stage.options.chainExplosionTime),playExplosionSound())})}),_defineProperty(this,"updateBombs",()=>{if(this.keyListener.isPressed("Space")&&this.stage.options.bombCount){const e=Math.floor((this.bomberman.left-1+this.stage.options.tileSize/2)/this.stage.options.tileSize+2),t=Math.floor((this.bomberman.top-1+this.stage.options.tileSize/2)/this.stage.options.tileSize+2);if(!this.stage.isBomb(e,t)&&!this.stage.isExitDoor(e,t)&&!this.stage.isWall(e,t)){const s=new Bomb({board:this.stage.board,x:e,y:t,explosionSize:this.stage.options.explosionSize,stage:this.stage});this.bomberman.isSurroundedWithBombs=!0,this.stage.addBomb(s),playBombLeaveSound()}}this.updateInstantBombs()}),_defineProperty(this,"drawEnemies",()=>{this.stage.enemies.forEach(e=>{e.draw()})}),_defineProperty(this,"draw",()=>{this.bomberman.draw(),this.bomberman.liveCountDiv.querySelector("span").innerText=`${this.bomberman.liveCount}`,this.drawEnemies(),this.stage.options.draw()}),_defineProperty(this,"initialize",()=>{this.screen.mainMenu.hideDisplay(),this.stage.initialize(),this.bomberman.initialize(),this.addEventListeners()}),_defineProperty(this,"addPauseHandler",()=>{document.addEventListener("keyup", e=>{"Escape"===e.code&&("stage"===this.state?this.state="pre-pause":"pause"===this.state&&(this.state="pre-pre-resume"))})}),_defineProperty(this,"pauseBomberman",()=>{this.bomberman.timer&&this.bomberman.timer.pause(),this.bomberman.img.className=`bomberman-look-${this.bomberman.direction}`}),_defineProperty(this,"resumeBomberman",()=>{this.bomberman.timer&&this.bomberman.timer.resume()}),_defineProperty(this,"pauseEnemies",()=>{this.stage.enemies.forEach(e=>{e.img.className=`enemy-look-${e.direction}`,e.timer&&e.timer.pause()})}),_defineProperty(this,"resumeEnemies",()=>{this.stage.enemies.forEach(e=>{e.timer&&e.timer.resume()})}),_defineProperty(this,"pauseBombs",()=>{this.stage.bombs.forEach(e=>{e.timer&&e.timer.pause(),e.img.className="bomb-paused"})}),_defineProperty(this,"resumeBombs",()=>{this.stage.bombs.forEach(e=>{e.timer&&e.timer.resume(),e.img.className="bomb-exploding"})}),_defineProperty(this,"restart",()=>{this.stage.restart(),this.bomberman.restart()}),_defineProperty(this,"gameMenuListener", e=>{"Enter"===e.code&&(0===this.gameMenu.selected?this.state="pre-pre-resume":1===this.gameMenu.selected?(this.restart(),this.state="pre-pre-resume"):2===this.gameMenu.selected&&location.reload())}),_defineProperty(this,"pause",()=>{this.pauseBomberman(),this.pauseEnemies(),this.pauseBombs(),document.addEventListener("keyup",this.gameMenuListener),this.gameMenu.show()}),_defineProperty(this,"resume",()=>{this.resumeBomberman(),this.resumeEnemies(),this.resumeBombs(),document.removeEventListener("keyup",this.gameMenuListener),this.gameMenu.hide()}),this.screen=new GameScreen;const n=this.checkArguments(e,t,s,i,o,r,a);n?this.error=n:(this.stageNumber=0,this.stages=a,this.stage=new Stage({data:a[this.stageNumber],pixelSize:e,tileSize:16*e,bombCount:i,explosionTime:t,explosionSize:s,chainExplosionTime:r}),this.stage.error?this.error=this.stage.error:(this.bomberman=new Bomberman({board:this.stage.board,pixelSize:e,liveCount:o}),this.keyListener=new KeyListener,this.gameMenu=new GameMenu,this.state="click-me",this.handleUserInteraction()))}isBombermanCollidedWithEnemies(){const{left:e,right:t,top:s,bottom:i}=this.bomberman.getBorders(this.stage.options.pixelSize,this.stage.options.tileSize,{own:!0});for(let o of this.stage.enemies){const{left:r,right:a,top:n,bottom:h}=o.getBorders(this.stage.options.pixelSize,this.stage.options.tileSize,{own:!0});if(!(s>h||t<r||e>a||i<n))return!0}}isBombermanExploded(){const{left:e,right:t,top:s,bottom:i}=this.bomberman.getBorders(this.stage.options.pixelSize,this.stage.options.tileSize,{own:!0,floorValues:!0}),o=this.bomberman.flamePass;return this.stage.isExplosion(e,s,{flamePass:o})||this.stage.isExplosion(e,i,{flamePass:o})||this.stage.isExplosion(t,s,{flamePass:o})||this.stage.isExplosion(t,i,{flamePass:o})}handleBombermanDeath(){this.bomberman.die(),this.state="pre-pre-die"}updateBomberman(){if(this.isBombermanCollidedWithEnemies())this.handleBombermanDeath();else if(this.isBombermanExploded())this.handleBombermanDeath();else{if(!this.stage.enemies.length&&this.isBombermanCollidedWithExitDoor())return this.updateStage(),void(this.state="pre-pre-stage-completed");this.handleBombermanCollidedWithPowerUp(),this.handleBombermanMove()}}handleEnemyExplosion(e){const{left:t,right:s,top:i,bottom:o}=e.getBorders(this.stage.options.pixelSize,this.stage.options.tileSize,{floorValues:!0});(this.stage.isExplosion(t,i)||this.stage.isExplosion(t,o)||this.stage.isExplosion(s,i)||this.stage.isExplosion(s,o))&&(this.stage.deleteEnemy(e),e.die(),this.stage.options.score+=e.xp,this.stage.enemies.length||(this.state="find-exit"))}moveEnemyRandomly(e){if(!e.dead){const{left:t,right:s,top:i,bottom:o}=e.getBorders(this.stage.options.pixelSize,this.stage.options.tileSize,{own:!0}),r=e.wallPass;if("left"===e.direction)return void(this.stage.isBlock(t,i+.05,{wallPass:r,enemy:!0})||this.stage.isBlock(t,o-.05,{wallPass:r,enemy:!0})?e.direction=getRandomDirection(["right","up","down"]):e.moveLeft());if("right"===e.direction)return void(this.stage.isBlock(s,i+.05,{wallPass:r,enemy:!0})||this.stage.isBlock(s,o-.05,{wallPass:r,enemy:!0})?e.direction=getRandomDirection(["left","up","down"]):e.moveRight());if("up"===e.direction)return void(this.stage.isBlock(t+.05,i,{wallPass:r,enemy:!0})||this.stage.isBlock(s-.05,i,{wallPass:r,enemy:!0})?e.direction=getRandomDirection(["left","right","down"]):e.moveUp());"down"===e.direction&&(this.stage.isBlock(t+.05,o,{wallPass:r,enemy:!0})||this.stage.isBlock(s-.05,o,{wallPass:r,enemy:!0})?e.direction=getRandomDirection(["left","right","up"]):e.moveDown())}}update(){this.updateBombs(),this.updateBomberman(),this.updateEnemies(),0===this.stage.options.roundTime&&(this.handleBombermanDeath(),this.state="pre-pre-die")}run(){let e=0;const t= s=>{requestAnimationFrame(t),this.error&&(document.querySelector("#incorrect-arguments").textContent=this.error,this.screen.incorrectArguments.showDisplay(),this.state="INCORRECT-ARGUMENTS"),"pre-main-menu"===this.state?(this.screen.mainMenu.showDisplay(),this.music.titleScreen.play(),this.state="main-menu"):"main-menu"===this.state&&this.keyListener.isPressed("Enter")?(this.state="initialize",this.music.titleScreen.stop()):"initialize"===this.state?(this.screen.hideStage(),this.initialize(),this.state="pre-stage-start"):"pre-stage-start"===this.state?(this.screen.stageStart.show(),this.screen.hideStage(),this.state="stage-start",this.music.stageStart.play(),e=s):"stage-start"===this.state?s-e>=this.music.stageStart.durationMS()&&(this.screen.stageStart.hide(),this.screen.showStage(),this.state="pre-stage"):"pre-stage"===this.state?(this.screen.showStage(),this.music.stage.play(),this.stage.options.initializeTimerChange(),this.state="stage"):"stage"===this.state?(e=s,this.update(),this.draw()):"pre-pause"===this.state?(this.music.stopStageMusic(),this.music.pause.stop(),this.music.pause.play(),this.pause(),this.state="pause"):"pause"===this.state?this.gameMenu.draw():"pre-pre-resume"===this.state?(e=s,this.music.pause.clear(),this.state="pre-resume"):"pre-resume"===this.state?(this.music.pause.stop(),this.music.pause.play(),this.gameMenu.hide(),this.state="resume"):"resume"===this.state?s-e>=this.music.pause.durationMS()/2&&(this.resume(),this.state="pre-stage"):"over"===this.state?(this.music.stopStageMusic(),this.music.over.play(),this.screen.hideStage(),this.screen.gameOver.showDisplay(),this.state="game-over"):"pre-pre-die"===this.state?(this.music.stopStageMusic(),this.pauseEnemies(),this.music.die.play(),this.state="pre-die"):"pre-die"===this.state?s-e>=this.music.die.durationMS()&&(this.music.die.stop(),this.music.lifeLost.play(),this.stage.options.score=this.stage.options.initialScore,this.state="die"):"die"===this.state?s-e>=this.music.die.durationMS()+this.music.lifeLost.durationMS()&&(e=s,this.bomberman.liveCount?(this.state="restart",this.stage.options.resetRoundTime()):this.state="over"):"restart"===this.state?(this.restart(),this.state="pre-stage-start"):"find-exit"===this.state?(this.music.stage.stop(),this.music.findExit.play(),this.state="stage"):"pre-pre-stage-completed"===this.state?(this.pauseBomberman(),this.music.stopStageMusic(),this.music.complete.play(),this.state="pre-stage-completed",e=s):"pre-stage-completed"===this.state?s-e>=this.music.complete.durationMS()&&(this.screen.hideStage(),this.state="stage-completed"):"stage-completed"===this.state?this.stageNumber<this.stages.length?(this.stage.reinitialize(this.stages[this.stageNumber]),this.bomberman.resetPosition(),this.state="pre-stage-start"):this.state="ending":"ending"===this.state&&(this.screen.info.hide(),this.screen.stage.hideDisplay(),this.music.ending.play(),this.screen.ending.showDisplay(),this.state="END")};requestAnimationFrame(t)}}const game=new Game({pixelSize:2,bombCount:1,explosionTime:2e3,stages:[{rows:13,columns:31,enemies:{ballom:3},powerUps:{bombs:1,flames:1,"wall-pass":1,"flame-pass":1,speed:1,"bomb-pass":1}}]});game.run();